project:
  name: "Classroom_GA_test1"

# global band order for material rows
bands_hz: [63, 125, 250, 500, 1000, 2000, 4000, 8000]

geometry:
  model_path: "C:/Users/usuario/Documents/TrebleSDK/models/001_classroom/classroom1.obj"
  model_name: "classroom1_obj"
  units: "m"
  up_axis: "z"
  layers_to_materials:
    walls_plasterboard: "My_Painted_Plasterboard"
    floor_linoleum:     "My_Linoleum_on_Slab"
    window:             "My_Glass_10mm"
    platform:           "My_Timber_Platform_Dense"
    door_timber:        "My_Solid_Core_Door"
    whiteboard:         "My_Whiteboard_Gloss"
    ceiling_plaster:    "My_Plasterboard_Ceiling"

materials:
  My_Painted_Plasterboard:
    description: "Painted 13 mm plasterboard on studs"
    type: "full_octave_absorption"
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    deviation_groups:
      low:   {bands: [63, 125],                deviation_pct: 0.80}
      mid:   {bands: [250, 500, 1000],         deviation_pct: 0.80}
      high:  {bands: [2000, 4000, 8000],       deviation_pct: 0.85}
    absorption: [0.15, 0.12, 0.10, 0.08, 0.07, 0.06, 0.06, 0.05]  # 63â€“8000 Hz
    scattering:  [0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10]

  My_Linoleum_on_Slab:
    description: "Linoleum on concrete slab"
    type: "full_octave_absorption"
    optimise: false                # fixed: do not calibrate
    optimise_absorption: true
    optimise_scattering: false
    # deviation_groups can be omitted when optimise=false
    absorption: [0.01, 0.02, 0.02, 0.02, 0.03, 0.03, 0.03, 0.03]
    scattering:  [0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05]

  My_Glass_10mm:
    description: "Monolithic glass 10 mm"
    type: "full_octave_absorption"
    optimise: true
    optimise_absorption: true
    optimise_scattering: false     # glazing: fix scattering
    deviation_groups:
      low:   {bands: [63, 125],                deviation_pct: 0.20}
      mid:   {bands: [250, 500, 1000],         deviation_pct: 0.20}  # slightly tighter
      high:  {bands: [2000, 4000, 8000],       deviation_pct: 0.20}
    absorption: [0.12, 0.10, 0.06, 0.04, 0.03, 0.02, 0.02, 0.02]
    scattering:  [0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02, 0.02]

  My_Timber_Platform_Dense:
    description: "Dense timber platform"
    type: "full_octave_absorption"
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    deviation_groups:
      low:   {bands: [63, 125],                deviation_pct: 0.20}
      mid:   {bands: [250, 500, 1000],         deviation_pct: 0.30}
      high:  {bands: [2000, 4000, 8000],       deviation_pct: 0.25}
    absorption: [0.12, 0.10, 0.08, 0.07, 0.06, 0.06, 0.06, 0.06]
    scattering:  [0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10]

  My_Solid_Core_Door:
    description: "Solid core timber door"
    type: "full_octave_absorption"
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    deviation_groups:
      low:   {bands: [63, 125],                deviation_pct: 0.20}
      mid:   {bands: [250, 500, 1000],         deviation_pct: 0.30}
      high:  {bands: [2000, 4000, 8000],       deviation_pct: 0.25}
    absorption: [0.15, 0.12, 0.10, 0.08, 0.07, 0.07, 0.07, 0.07]
    scattering:  [0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10]

  My_Whiteboard_Gloss:
    description: "Gloss laminate whiteboard"
    type: "full_octave_absorption"
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    deviation_groups:
      low:   {bands: [63, 125],                deviation_pct: 0.20}
      mid:   {bands: [250, 500, 1000],         deviation_pct: 0.30}
      high:  {bands: [2000, 4000, 8000],       deviation_pct: 0.25}
    absorption: [0.10, 0.08, 0.06, 0.05, 0.04, 0.04, 0.04, 0.04]
    scattering:  [0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 0.05]

  My_Plasterboard_Ceiling:
    description: "Plain plasterboard ceiling"
    type: "full_octave_absorption"
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    deviation_groups:
      low:   {bands: [63, 125],                deviation_pct: 0.20}
      mid:   {bands: [250, 500, 1000],         deviation_pct: 0.30}
      high:  {bands: [2000, 4000, 8000],       deviation_pct: 0.25}
    absorption: [0.15, 0.12, 0.10, 0.09, 0.08, 0.08, 0.08, 0.08]
    scattering:  [0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10]

data:
  base_dir: "data/001_classroom"
  ambi_dir: "data/001_classroom/ambi"
  omni_dir: "data/001_classroom/omni"
  src_locations_json: "C:/Users/usuario/Documents/TrebleSDK/data/001_classroom/src_locations.json"

statistical_prepass:
  enabled: true
  method: eyring
  target_json: "C:/Users/usuario/Documents/TrebleSDK/data/001_classroom/omni/targets_measured_omni.json"
  receivers:
    - R_30x00y
    - R_05x15y
    - R_30x25y
    - R_60x35y
    - R_05x45y        # or list
  metric_key_map:
    T20: T20_s
    T30: T30_s
    EDT: EDT_s
    C50: C50_dB
    C80: C80_dB
    optimise_from_hz: 125
  out_dir: "C:/Users/usuario/Documents/TrebleSDK/results/stat_prepass"
  volume_m3: 236.0
  plot_every: 1             # save PNG every iter
  out_dir: "./out_stat/"
  weights:
    T20_s: 1.0
    EDT_s: 0.7
  constraints:
    smoothness_lambda: 0.05
    monotonic_lambda: 0.05
    max_step: 0.08     # ðŸ‘ˆ new: max allowed change between neighbour bands

sources:
  - id: "src_main"
    position: [4.5, 0.53, 1.5]
    type: "directive"
    directivity:
      cf2_path: "C:/Users/usuario/Documents/TrebleSDK/data/001_classroom/GenelecOy-8030.cf2"
      enabled: true

receivers:
  use_all: true

target:
  master_json: data/001_classroom/omni/targets_measured_omni.json
  focus_receivers:     # the ones we REALLY care about
    - "60x15y"
    #- "35x15y"
    #- "40x15y"
  average_mode: "all"  # or "row", "col", "focus"
  metrics: ["EDT", "T20", "C50", "C80"]  # to override whatâ€™s in master

analysis:
  metrics: ["EDT", "T20", "C50", "C80", "G"]

calculation:
  simulation_type: "hybrid"
  crossover_frequency: 720
  termination:
    mode: "energy_decay"
    energy_decay_threshold: 35
    ir_length_s: 3.0
  ga:
    rays_per_source: 20000
    max_reflections: 12
    max_diffractions: 1
    ray_energy_threshold_db: -60
    scatter_model: "sdk_default"
    image_source_order: 2
  dg:
    mesh_simplification: "auto"
    smallest_feature_m: 0.1
    max_courant: 0.7
  postproc:
    export_wavs: true
    export_folder: "results"

simulation:
  name_prefix: "classroom1_"
  wait_timeout_s: 1800

optimisation:
  objective_metrics: ["EDT"]   # # or ["T20", "EDT", "C50"] what to compare in metrics_compare
  stage: "A"
  max_generations: 50 
  population_size: 30
  crossover_rate: 0.7 
  mutation_rate: 0.2 
  elite_size: 2 
  convergence_threshold: 0.001
  convergence_generations: 10
  parallel_evaluations: 4
  random_seed: 42
  results_folder: "results/optimisation"
 