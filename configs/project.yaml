# =========================
# Project master config
# =========================
project:
  name: Classroom_OBJ
  run_label: "baseline_v2"          # optional tag appended to run folders
model:
  name: classroom1
paths:
  model_obj: C:/Users/usuario/Documents/TrebleSDK/v2/input/obj/classroom1.obj
  ground_truth_json: C:/Users/usuario/Documents/TrebleSDK/v2/data/omni/targets_measured_omni.json  
  directivity_cf2: C:/Users/usuario/Documents/TrebleSDK/v2/input/directivity/GenelecOy-8030_v2.cf2
  working_dir: "results"             # base for run outputs
  temp_dir: "results/.tmp"           # scratch

bands:
  kind: octave                        # third | octave
  f_hz: [63, 125, 250, 500, 1000, 2000, 4000, 8000]
  optimise_from_hz: 125              # ignore LF below this for optimisation loss

# If you want the script to honour measured receiver codes, keep this structure.
receivers:
  - id: 1
    name: "30x00y"
    rcv_code: "R_30x00y"
    xyz_m: [4.50, 1.90, 1.50]
  - id: 2
    name: "60x15y"
    rcv_code: "R_60x15y"
    xyz_m: [7.5, 3.4, 1.50]
  - id: 3
    name: "00x20y"  
    rcv_code: "R_00x20y"
    xyz_m: [1.5, 4, 1.50]     
  - id: 4
    name: "40x30y" 
    rcv_code: "R_40x30y" 
    xyz_m: [5.50, 5.00, 1.50]
  - id: 5
    name: "15x40y" 
    rcv_code: "R_15x40y"
    xyz_m: [3, 6.00, 1.50] 

# Source: directivity & pose
source:
  kind: "directive"                  # omni | directive
  directivity_file: "@paths.directivity_cf2"
  position_m: [4.50, 0.53, 1.50]
  orientation_deg_xyz: [0.0, 0.0, 0.0]   # optional, if Treble uses it

# Mesh â†” materials: by default, areas come from the OBJ scan.
# You can override specific mÂ² with area_m2_override.
materials:
  # NOTE:
  # - m2 is optional; if omitted, we compute from mesh.
  # - type: "full_octave_absorption" aligns with your current approach.
  # - optimise flags control GA degrees-of-freedom.
  # - deviation_groups let you widen/tighten % jitter by band groups during GA.
  # - anchors: fixed per-band reference you want to (soft constraint).

  My_Plasterboard_Ceiling:
    description: "Plain plasterboard ceiling"
    type: "full_octave_absorption"
    area_m2_override: null                  # or a number to pin area
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    anchors:
      absorption: [0.15, 0.12, 0.10, 0.09, 0.08, 0.08, 0.08, 0.08]
      scattering: [0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10]
    deviation_groups:
      low:  { bands: [63, 125],               deviation_pct: 0.20 }
      mid:  { bands: [250, 500, 1000],        deviation_pct: 0.50 }
      high: { bands: [2000, 4000, 8000],      deviation_pct: 0.60 }

  My_Painted_Plasterboard:
    description: "Painted plasterboard walls"
    type: "full_octave_absorption"
    area_m2_override: null
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    anchors:
      absorption: [0.10, 0.08, 0.07, 0.06, 0.06, 0.05, 0.05, 0.05]
      scattering: [0.07, 0.07, 0.07, 0.08, 0.08, 0.09, 0.09, 0.10]
    deviation_groups:
      low:  { bands: [63, 125],               deviation_pct: 0.20 }
      mid:  { bands: [250, 500, 1000],        deviation_pct: 0.50 }
      high: { bands: [2000, 4000, 8000],      deviation_pct: 0.60 }

  My_Glass_10mm:
    description: "Monolithic glass 10 mm"
    type: "full_octave_absorption"
    area_m2_override: null
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    anchors:
      absorption: [0.03, 0.03, 0.03, 0.04, 0.04, 0.05, 0.05, 0.05]
      scattering: [0.20, 0.20, 0.25, 0.25, 0.30, 0.30, 0.30, 0.30]
    deviation_groups:
      low:  { bands: [63, 125],               deviation_pct: 0.20 }
      mid:  { bands: [250, 500, 1000],        deviation_pct: 0.50 }
      high: { bands: [2000, 4000, 8000],      deviation_pct: 0.60 }

  My_Timber_Platform_Dense:
    description: "Timber platform, dense"
    type: "full_octave_absorption"
    area_m2_override: null
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    anchors:
      absorption: [0.06, 0.06, 0.06, 0.06, 0.07, 0.07, 0.07, 0.07]
      scattering: [0.15, 0.15, 0.15, 0.15, 0.18, 0.18, 0.20, 0.20]
    deviation_groups:
      low:  { bands: [63, 125],               deviation_pct: 0.20 }
      mid:  { bands: [250, 500, 1000],        deviation_pct: 0.50 }
      high: { bands: [2000, 4000, 8000],      deviation_pct: 0.60 }

  My_Solid_Core_Door:
    description: "Solid core door"
    type: "full_octave_absorption"
    area_m2_override: null
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    anchors:
      absorption: [0.15, 0.12, 0.10, 0.08, 0.07, 0.06, 0.06, 0.05]
      scattering: [0.10, 0.10, 0.12, 0.12, 0.14, 0.14, 0.16, 0.16]
    deviation_groups:
      low:  { bands: [63, 125],               deviation_pct: 0.20 }
      mid:  { bands: [250, 500, 1000],        deviation_pct: 0.50 }
      high: { bands: [2000, 4000, 8000],      deviation_pct: 0.60 }

  My_Whiteboard_Gloss:
    description: "Gloss whiteboard"
    type: "full_octave_absorption"
    area_m2_override: null
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    anchors:
      absorption: [0.05, 0.04, 0.04, 0.03, 0.03, 0.03, 0.03, 0.03]
      scattering: [0.12, 0.12, 0.14, 0.14, 0.15, 0.16, 0.16, 0.16]
    deviation_groups:
      low:  { bands: [63, 125],               deviation_pct: 0.20 }
      mid:  { bands: [250, 500, 1000],        deviation_pct: 0.50 }
      high: { bands: [2000, 4000, 8000],      deviation_pct: 0.60 }
  My_Linoleum_on_Slab:
    description: "Linoleum on concrete slab"    
    type: "full_octave_absorption"
    area_m2_override: null    
    optimise: true
    optimise_absorption: true
    optimise_scattering: false
    anchors:
      absorption: [0.01, 0.02, 0.02, 0.02, 0.03, 0.03, 0.03, 0.03]
      scattering: [0.01, 0.01, 0.01, 0.01, 0.15, 0.16, 0.16, 0.16]  
    deviation_groups:
      low:  { bands: [63, 125],               deviation_pct: 0.20 }
      mid:  { bands: [250, 500, 1000],        deviation_pct: 0.50 }
      high: { bands: [2000, 4000, 8000],      deviation_pct: 0.60 }
      
# Mapping from mesh tags (OBJ/SKP) to the logical material keys above.
tag_to_material:
  ceiling_plaster:      My_Plasterboard_Ceiling
  window:               My_Glass_10mm
  platform:             My_Timber_Platform_Dense
  walls_plasterboard:   My_Painted_Plasterboard
  door_timber:          My_Solid_Core_Door
  whiteboard:           My_Whiteboard_Gloss
  floor_linoleum:       My_Linoleum_on_Slab
  

# What weâ€™ll compare against the ground truth and how we weight it.
metrics:
  objective_metrics: ["t20"]         # or ["T20", "EDT", "C50"]
  weights:                           # optional per-metric weights (default = 1.0)
    edt: 0.5
    t20: 1.0
    c50: 0.5
  # Huber delta in natural units (s or dB) per metric
  huber_delta:
    edt: 0.5
    t20: 1.0
    c50: 0.5

# Treble calculation parameters (hybrid = GA + DG)
calculation:
  simulation_type: "hybrid"          # "ga" | "dg" | "hybrid"
  crossover_frequency_hz: 720
  termination:
    mode: "energy_decay"             # "energy_decay" | "ir_length"
    energy_decay_threshold_db: 35
    ir_length_s: 3.0
  ga:
    rays_per_source: 10000
    max_reflections: 12
    max_diffractions: 1
    ray_energy_threshold_db: -60
    scatter_model: "sdk_default"
    image_source_order: 2
  dg:
    mesh_simplification: "auto"
    smallest_feature_m: 0.1
    max_courant: 0.7
  postproc:
    export_wavs: true
    export_folder: "results"         # relative to working_dir

# Optimisation controller (Stage: A = absorption seed; B = GA refinement)
optimisation:
  stage: "A"                         # "A" (statistical seed) or "B" (full GA)
  population_size: 30
  max_generations: 50
  crossover_rate: 0.7
  mutation_rate: 0.2
  elite_size: 2
  convergence_threshold: 0.001
  convergence_generations: 10
  parallel_evaluations: 4
  random_seed: 42
  results_folder: "results/optimisation"   # under working_dir
